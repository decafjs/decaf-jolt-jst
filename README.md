decaf-jolt-jst
==============

JST server for decaf jolt

### JstServer

Jst is a simple PHP-like or JSP-like template language that compiles into JavaScript.  Jst source files may contain any arbitrary text, with two exceptions.  Text between ```<%``` and ```%>``` tags is raw JavaScript and simply is executed in line.  And text between ```<%=``` and ```%>``` tags is replaced with the value of the JavaScript expression within those tags.

Jst scripts do not call the res object methods to write content to the browser.  Instead they call print(s), and println(s).  These append strings to a special res.out member that will ultimately contain the response body.  The scripts **MAY** set cookies, set headers, set the content-type header, etc., in the res object.

A special version of include() is implemented for Jst scripts.  This is required so the text generated by the included Jst is added to res.out properly.

The default content type is 'text/html' but you might create CSS with Jst (works great!) and you'd need to set the content type to 'text/css'.

Jolt facilitates the implementation of all or part of your server application in Jst via the JstServer class.  

```
app.verb('jst', new JstServer('path/to/your-jst-files'[, options ]));
```

Or

```
app.verb('hello', new JstFile('path/to/hello.jst'[, options ]));
```

The JstServer class executes Jst scripts within a directory, much like CoffeeScriptServer serves its scripts.  If the URL requested is a subdirectory within 'path/to/your-jst-files', then this class tries to serve the index.jst file in that directory.

The JstFile class associates an absolute verb to a Jst script; it does not serve scripts from within a directory.  The following example sets the site home page to be served by '/path/to/your-jst-files/default.jst':

```
app.verb('/', new JstFile('path/to/your-jst-files/default.jst'));
```

The power of include() is that you can implement a common site header in a .jst file and include() it in all your page sources, and similarly you can implement footer, navigation, etc.

It is probably a good idea to store your include() .jst files in a directory that is not being served by Jolt.  You may include() files from any path on your hard drive!  But you will need to tell JstFile or JstServer where to find these include() files.  This is done via the optional ```options``` hash/argument:

```
app.verb('jst', new JstServer('path/to/your-jst-files', {
	jstPath: 'path/to/your-jst-includes'
}));
```

By default, Jolt gzip compresses responses if the client accepts those.  If you want to disable gzip, you can set ```gzip: false`` in the options hash.

Additionally, any options you pass in, whether they are jstPath or gzip or anything else you choose, they will appear to your Jst scripts in the ```res.options``` member variable/hash.

The first time a Jst script is requested or included, it will be loaded from the file system, compiled into JavaScript, and made into a function and that function called.  Each successive time the script is requested or included, the file modification time on the disk file is checked against the modification time of the file that was loaded; if the disk file is newer, it is loaded and compiled and made into a Function and called.  

